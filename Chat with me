--[[
üí† DXD: Ultimate Loader (v3 - fixed)
‡∏£‡∏ß‡∏° Banlist + Map Loader + WarpControl + Chat with Me v5.1
- WarpControl ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏°‡∏û‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
- Chat with Me ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å‡πÅ‡∏°‡∏û‡∏´‡∏•‡∏±‡∏á WarpControl 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
@credit: chatgpt
]]

-------------------------------------------------
-- üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢
-------------------------------------------------
local function safeHttpGet(url)
    local ok, res = pcall(function()
        return game:HttpGet(url)
    end)
    if not ok then
        return false, ("HttpGet failed: %s"):format(tostring(res))
    end
    return true, res
end

local function safeLoad(url, desc)
    local ok, body = safeHttpGet(url)
    if not ok then
        warn("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ("..desc.."): "..tostring(body))
        return false
    end
    local ok2, err = pcall(function()
        loadstring(body)()
    end)
    if ok2 then
        print("‚úÖ "..desc.." loaded successfully.")
        return true
    else
        warn("‚ö†Ô∏è "..desc.." execution error: "..tostring(err))
        return false
    end
end

-------------------------------------------------
-- üö´ ‡πÄ‡∏ä‡πá‡∏Ñ Banlist
-------------------------------------------------
print("Checking Banlist üîÉ")
for i = 1, 100, math.random(5, 15) do
    task.wait(0.05)
    print("Loading... " .. i .. "%")
end
print("Loading... 100% ‚úÖ")

local isBanned = false
do
    local banUrl = "https://raw.githubusercontent.com/wkdopajwiojf/Zombie-game/main/Ban%20land"
    local ok, bodyOrErr = safeHttpGet(banUrl)
    if not ok then
        warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Banlist -> " .. tostring(bodyOrErr))
        isBanned = false
    else
        local ok2, ret = pcall(function()
            return loadstring(bodyOrErr)()
        end)
        if not ok2 then
            warn("‚ö†Ô∏è Banlist execution error -> " .. tostring(ret))
            isBanned = false
        else
            isBanned = (ret == true)
        end
    end
end

if isBanned then
    print("üö´ Ban Detected! Script stopped.")
    return
end

print("‚úÖ Player not banned. Continuing...")

-------------------------------------------------
-- 1Ô∏è‚É£ ‡πÇ‡∏´‡∏•‡∏î WarpControl ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏°‡∏û‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
-------------------------------------------------
local mapId = game.PlaceId
local WARP_ALLOWED = {
    [14835828495] = true,
    [17455699549] = true,
    [10449761463] = true
}

if WARP_ALLOWED[mapId] then
    print("üü° Loading DXD WarpControl (Classic Key Edition)...")
    safeLoad("https://raw.githubusercontent.com/wkdopajwiojf/WarpControl/main/ClassicKey.lua", "WarpControl")
else
    print("‚è≠Ô∏è WarpControl skipped (not in allowed map).")
end

-------------------------------------------------
-- 2Ô∏è‚É£ ‡πÇ‡∏´‡∏•‡∏î Chat with Me (DXD Relay UI v5.1)
-- ‡∏´‡∏ô‡πà‡∏ß‡∏á 8 ‡∏ß‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ WarpControl ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏ô‡πà‡πÜ
-------------------------------------------------
task.delay(8, function()
    print("üí¨ Loading Chat with Me UI (after WarpControl ready)...")
    local CHAT_URL = "https://raw.githubusercontent.com/wkdopajwiojf/Check-id-map/refs/heads/main/Chat%20with%20me"
    local ok, res = pcall(function()
        return game:HttpGet(CHAT_URL)
    end)
    if ok then
        local ok2, err = pcall(function()
            loadstring(res)()
        end)
        if ok2 then
            print("‚úÖ Chat UI loaded successfully after WarpControl.")
        else
            warn("‚ùå Chat UI failed: " .. tostring(err))
        end
    else
        warn("‚ùå Chat UI download failed: " .. tostring(res))
    end
end)

-------------------------------------------------
-- 3Ô∏è‚É£ ‡πÇ‡∏´‡∏•‡∏î SCRIPT ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏° MAP (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
-------------------------------------------------
local url
if mapId == 138365924124161 then
    url = "https://raw.githubusercontent.com/wkdopajwiojf/Backrooms-Drift/refs/heads/main/Script"
elseif mapId == 14419907512 then
    url = "https://raw.githubusercontent.com/wkdopajwiojf/Zombie-game/refs/heads/main/Eng%20version%20%E0%B8%94%E0%B8%B1%E0%B8%94%E0%B9%81%E0%B8%9B%E0%B8%A5%E0%B8%87%20script%20%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B8%99%E0%B8%B5%E0%B9%88"
elseif mapId == 9872472334 then
    url = "https://raw.githubusercontent.com/wkdopajwiojf/evade-bypass-countdown/refs/heads/main/Protected_8932730771877973.lua.txt"
elseif WARP_ALLOWED[mapId] then
    url = "https://raw.githubusercontent.com/arm17966/Tploop-/refs/heads/main/Tploop%E0%B9%80%E0%B8%82%E0%B9%89%E0%B8%B2%E0%B8%A3%E0%B8%AB%E0%B8%B1%E0%B8%AA"
end

if url then
    print("üåç Detected map-specific script for PlaceId:", mapId)
    safeLoad(url, "Map-Specific Script")
else
    print("‚ÑπÔ∏è No map-specific script found. Using defaults only.")
end

-------------------------------------------------
-- üßæ Log Summary
-------------------------------------------------
print("==========================================")
print("üì¶ DXD Ultimate Loader Initialized ‚úÖ")
print("  - Banlist Check: OK")
print("  - WarpControl: Loaded only in allowed maps")
print("  - Chat with Me: Loaded every map (after delay)")
print("  - Map Loader: Active")
print("==========================================")
