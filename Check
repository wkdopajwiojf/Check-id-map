--[[ DXD Relay UI: Banlist Checker + Map Loader + Chat UI v5.1
   - à¹€à¸Šà¹‡à¸„à¹à¸šà¸™à¸à¹ˆà¸­à¸™à¸£à¸±à¸™ à¸–à¹‰à¸²à¹à¸šà¸™à¸«à¸¢à¸¸à¸”à¸—à¸±à¸™à¸—à¸µ
   - à¹‚à¸«à¸¥à¸” script à¹€à¸‰à¸à¸²à¸°à¹à¸•à¹ˆà¸¥à¸°à¹à¸¡à¸ (PlaceId)
   - à¹€à¸•à¸°à¸–à¹‰à¸² map à¹„à¸¡à¹ˆà¸•à¸£à¸‡
   - Bubble Chat UI (Owner Highlight, Auto-scroll, à¹à¸ªà¸”à¸‡à¹€à¸§à¸¥à¸²)
   - à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸à¸±à¹ˆà¸‡à¸•à¸±à¸§à¹€à¸­à¸‡à¸Šà¸´à¸”à¸‚à¸§à¸² à¸ªà¸µà¸Ÿà¹‰à¸² / à¸à¸±à¹ˆà¸‡à¸­à¸·à¹ˆà¸™à¸Šà¸´à¸”à¸‹à¹‰à¸²à¸¢ à¸ªà¸µà¸ªà¹‰à¸¡ / Owner à¸ªà¸µà¹à¸”à¸‡
]]

-- 1. à¹€à¸Šà¹‡à¸„à¹à¸šà¸™à¸à¹ˆà¸­à¸™à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡
local HttpService = game:GetService("HttpService")
print("Checking Banlist ğŸ”ƒ")
for i = 1, 100, math.random(5, 15) do
    task.wait(0.05)
    print("Loading... " .. i .. "%")
end
print("Loading... 100% âœ…")
local isBanned = loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/Zombie-game/main/Ban%20land'))()
if isBanned then
    print("Ban âŒ")
    return
end
print("Success âœ…")

-- 2. Loader à¹€à¸‰à¸à¸²à¸° map (PlaceId)
local mapId = game.PlaceId
if mapId == 138365924124161 then
    loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/Backrooms-Drift/refs/heads/main/Script'))()
elseif mapId == 14419907512 then
    loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/Zombie-game/refs/heads/main/Eng%20version%20%E0%B8%94%E0%B8%B1%E0%B8%94%E0%B9%81%E0%B8%9B%E0%B8%A5%E0%B8%87%20script%20%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B8%99%E0%B8%B5%E0%B9%88'))()
elseif mapId == 9872472334 then
    loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/evade-bypass-countdown/refs/heads/main/Protected_8932730771877973.lua.txt'))()
elseif mapId == 10449761463 or mapId == 14835828495 or mapId == 17455699549 then
    loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/dww/refs/heads/main/i'))()
else
    -- à¹€à¸•à¸°à¸«à¸£à¸·à¸­à¹à¸ªà¸”à¸‡à¹€à¸•à¸·à¸­à¸™/à¹‚à¸«à¸¥à¸” script à¸­à¸·à¹ˆà¸™à¸–à¹‰à¸² map à¹„à¸¡à¹ˆà¸•à¸£à¸‡
    loadstring(game:HttpGet('https://raw.githubusercontent.com/wkdopajwiojf/Check-id-map/refs/heads/main/Chat%20with%20me'))()
    return
end

-- 3. DXD Relay UI v5.1
------------------------------------------------------
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RELAY_URL = "https://dxd-1.onrender.com"
local RELAY_KEY = "222554"

local REQUEST = (syn and syn.request) or http_request or request or (fluxus and fluxus.request)
assert(REQUEST, "Executor à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š request")

-- ğŸªŸ GUI Setup
local screen = Instance.new("ScreenGui", game:GetService("CoreGui"))
screen.Name = "DXD_ChatUI"
screen.ResetOnSpawn = false

local frame = Instance.new("Frame", screen)
frame.AnchorPoint = Vector2.new(1,1)
frame.Position = UDim2.new(1,-16,1,-16)
frame.Size = UDim2.new(0,360,0,260)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.BackgroundTransparency = 0.08
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local messages = Instance.new("ScrollingFrame", frame)
messages.Position = UDim2.new(0,10,0,40)
messages.Size = UDim2.new(1,-20,1,-90)
messages.BackgroundTransparency = 1
messages.ScrollBarThickness = 6
messages.CanvasSize = UDim2.new(0,0,0,0)
Instance.new("UICorner", messages).CornerRadius = UDim.new(0,8)

local layout = Instance.new("UIListLayout", messages)
layout.Padding = UDim.new(0,6)
layout.SortOrder = Enum.SortOrder.LayoutOrder

local textBox = Instance.new("TextBox", frame)
textBox.Position = UDim2.new(0,10,1,-42)
textBox.Size = UDim2.new(1,-120,0,32)
textBox.PlaceholderText = "Type..."
textBox.ClearTextOnFocus = false
textBox.Font = Enum.Font.Gotham
textBox.TextSize = 18
textBox.TextColor3 = Color3.new(1,1,1)
textBox.BackgroundColor3 = Color3.fromRGB(35,35,35)
Instance.new("UICorner", textBox).CornerRadius = UDim.new(0,8)

local sendBtn = Instance.new("TextButton", frame)
sendBtn.Position = UDim2.new(1,-98,1,-42)
sendBtn.Size = UDim2.new(0,88,0,32)
sendBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
sendBtn.Font = Enum.Font.GothamBlack
sendBtn.TextSize = 19
sendBtn.TextColor3 = Color3.fromRGB(230,230,230)
sendBtn.Text = "Send"
Instance.new("UICorner", sendBtn).CornerRadius = UDim.new(0,8)

local credit = Instance.new("TextLabel", frame)
credit.Size = UDim2.new(1,-20,0,16)
credit.Position = UDim2.new(0,10,1,-20)
credit.BackgroundTransparency = 1
credit.Font = Enum.Font.Gotham
credit.TextSize = 13
credit.TextColor3 = Color3.fromRGB(120,180,255)
credit.TextXAlignment = Enum.TextXAlignment.Right
credit.Text = "Powered by à¸¥à¸¸à¸‡à¸­à¸²à¸£à¹Œà¸¡ (Lunarplyr)"

-- â° Utility
local function getTimeTag()
	local t = os.date("*t")
	return string.format("[%02d:%02d]", t.hour, t.min)
end

-- ğŸ’¬ à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (Bubble, Owner Highlight)
local function addMessage(author, text, isSelf)
	local line = Instance.new("TextLabel")
	line.Parent = messages
	line.BackgroundTransparency = 1
	line.Font = Enum.Font.Gotham
	line.TextSize = 18
	line.TextWrapped = true
	line.AutomaticSize = Enum.AutomaticSize.XY
	line.Size = UDim2.new(1,0,0,0)
	line.ClipsDescendants = true
	line.TextTransparency = 0

	-- Owner Highlight
	local displayName = author
	local color = Color3.fromRGB(220,220,220)
	if author == "Lunarplyr" then
		displayName = "Owner " .. author
		color = Color3.fromRGB(255,80,80)
	elseif author == "[Discord] jeffyhey" or author == "jeffyhey" then
		displayName = "Owner " .. author
		color = Color3.fromRGB(255,120,120)
	end

	local t = getTimeTag()

	if isSelf then
		-- à¸à¸±à¹ˆà¸‡à¸•à¸±à¸§à¹€à¸­à¸‡ (à¸‚à¸§à¸² à¸Ÿà¹‰à¸²)
		line.Text = string.format("%s :%s %s", text, displayName, t)
		line.TextXAlignment = Enum.TextXAlignment.Right
		line.TextColor3 = Color3.fromRGB(100,200,255)
	else
		-- à¸à¸±à¹ˆà¸‡à¸­à¸·à¹ˆà¸™/Discord (à¸‹à¹‰à¸²à¸¢)
		line.Text = string.format("%s %s: %s", t, displayName, text)
		line.TextXAlignment = Enum.TextXAlignment.Left
		line.TextColor3 = color
	end

	task.wait()
	messages.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 10)
	messages.CanvasPosition = Vector2.new(0, math.max(0, layout.AbsoluteContentSize.Y - messages.AbsoluteWindowSize.Y))
end

-- ğŸš€ à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸‚à¸¶à¹‰à¸™ Discord
local function sendToDiscord(txt)
	local body = HttpService:JSONEncode({author = player.Name, text = txt})
	local ok, res = pcall(function()
		return REQUEST({
			Url = RELAY_URL .. "/to-discord",
			Method = "POST",
			Headers = {["Content-Type"]="application/json", ["x-relay-key"]=RELAY_KEY},
			Body = body
		})
	end)
	if not ok or (res and res.StatusCode ~= 200) then
		addMessage("System", "âŒ Relay Error", false)
	end
end

-- à¸£à¸°à¸šà¸šà¸ªà¹ˆà¸‡ (à¸›à¸¸à¹ˆà¸¡/Enter)
local function handleSend()
	local txt = textBox.Text
	if txt ~= "" then
		addMessage(player.Name, txt, true)
		sendToDiscord(txt)
		textBox.Text = ""
	end
end

sendBtn.MouseButton1Click:Connect(handleSend)
textBox.FocusLost:Connect(function(enterPressed)
	if enterPressed then handleSend() end
end)

-- ğŸŒ Poll à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆà¸ˆà¸²à¸ Relay à¸—à¸¸à¸ 1 à¸§à¸´
task.spawn(function()
	local lastId = 0
	while true do
		local ok, res = pcall(function()
			return REQUEST({
				Url = RELAY_URL .. "/messages",
				Method = "GET",
				Headers = {["x-relay-key"]=RELAY_KEY}
			})
		end)
		if ok and res and res.StatusCode == 200 and res.Body then
			local decoded = HttpService:JSONDecode(res.Body)
			if decoded and decoded.ok and decoded.messages then
				for _,m in ipairs(decoded.messages) do
					if m.text and (not m.id or m.id > lastId) then
						addMessage(m.author or "???", m.text, false)
						if m.id then lastId = m.id end
					end
				end
			end
		end
		task.wait(1)
	end
end)

-- ğŸ¬ Init
addMessage("System","DXD Relay ready âœ…", false)
